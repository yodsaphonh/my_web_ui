<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stable Diffusion A1111 WebUI</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <header>
        <h1>Stable Diffusion A1111 WebUI</h1>
        <p class="subtitle">Generate images with txt2img using your local or remote Automatic1111 API.</p>
    </header>

    <main>
        <section class="configuration">
            <div class="connection-settings">
                <div class="form-row two-column">
                    <label>
                        Base API URL
                        <input type="url" id="base-url" name="base-url" placeholder="http://127.0.0.1:7860" value="http://127.0.0.1:7860" required>
                    </label>
                    <label>
                        Model
                        <div class="model-selector">
                            <select id="model" name="model">
                                <option value="">Default</option>
                            </select>
                            <button type="button" id="refresh-models" title="Refresh models">â†»</button>
                        </div>
                        <span class="help">Loads models from /sdapi/v1/sd-models</span>
                    </label>
                </div>
            </div>

            <div class="tabset">
                <div class="tab-buttons">
                    <button type="button" class="tab-button active" data-tab-target="txt2img-tab">txt2img</button>
                    <button type="button" class="tab-button" data-tab-target="hiresfix-tab">Hires Fix</button>
                </div>

                <section id="txt2img-tab" class="tab-panel active">
                    <form id="txt2img-form">
                        <div class="form-row two-column">
                            <label>
                                Prompt
                                <textarea id="prompt" name="prompt" rows="4" placeholder="A futuristic cityscape at sunset"></textarea>
                            </label>
                            <label>
                                Negative Prompt
                                <textarea id="negative-prompt" name="negative-prompt" rows="4" placeholder="Low quality, blurry"></textarea>
                            </label>
                        </div>

                        <div class="form-row three-column">
                            <label>
                                Width
                                <input type="number" id="width" name="width" value="512" min="64" step="64">
                            </label>
                            <label>
                                Height
                                <input type="number" id="height" name="height" value="512" min="64" step="64">
                            </label>
                            <label>
                                Steps
                                <input type="number" id="steps" name="steps" value="20" min="1" max="150">
                            </label>
                        </div>

                        <div class="form-row three-column">
                            <label>
                                Sampler
                                <select id="sampler" name="sampler">
                                    <option value="">Default</option>
                                </select>
                                <span class="help">Populated from /sdapi/v1/samplers</span>
                            </label>
                            <label>
                                Scheduler
                                <select id="scheduler" name="scheduler">
                                    <option value="">Default</option>
                                </select>
                                <span class="help">Populated from /sdapi/v1/schedulers</span>
                            </label>
                            <label>
                                CFG Scale
                                <input type="number" id="cfg-scale" name="cfg-scale" value="7" min="1" max="20" step="0.5">
                            </label>
                        </div>

                        <div class="form-row three-column">
                            <label>
                                Batch Size
                                <input type="number" id="batch-size" name="batch-size" value="1" min="1" max="8">
                            </label>
                            <label>
                                Seed
                                <input type="number" id="seed" name="seed" value="-1" step="1">
                                <span class="help">Use -1 for random seed</span>
                            </label>
                            <label>
                                Restore Faces
                                <select id="restore-faces" name="restore-faces">
                                    <option value="false" selected>No</option>
                                    <option value="true">Yes</option>
                                </select>
                            </label>
                        </div>

                        <div class="form-row">
                            <label class="toggle">
                                <input type="checkbox" id="enable-hr" name="enable-hr">
                                <span>Enable Hires Fix in request</span>
                            </label>
                        </div>

                        <div id="hr-settings" class="hr-settings" hidden>
                            <div class="form-row three-column">
                                <label>
                                    Hires Steps
                                    <input type="number" id="hr-steps" name="hr-steps" value="0" min="0" max="150">
                                </label>
                                <label>
                                    Hires Sampler
                                    <select id="hr-sampler" name="hr-sampler">
                                        <option value="">Default</option>
                                    </select>
                                </label>
                                <label>
                                    Hires Scheduler
                                    <select id="hr-scheduler" name="hr-scheduler">
                                        <option value="">Default</option>
                                    </select>
                                </label>
                            </div>
                            <div class="form-row three-column">
                                <label>
                                    Denoising Strength
                                    <input type="number" id="hr-denoising" name="hr-denoising" value="0.4" min="0" max="1" step="0.01">
                                </label>
                                <label>
                                    Upscaler
                                    <select id="hr-upscaler" name="hr-upscaler">
                                        <option value="">Latent</option>
                                    </select>
                                </label>
                                <label>
                                    Upscale Factor
                                    <input type="number" id="hr-scale" name="hr-scale" value="2" min="1" max="4" step="0.1">
                                </label>
                            </div>
                        </div>

                        <div class="form-row">
                            <button type="submit" id="generate">Generate</button>
                        </div>
                    </form>
                </section>

                <section id="hiresfix-tab" class="tab-panel">
                    <form id="hiresfix-form">
                        <div class="form-row two-column align-start">
                            <label class="image-loader">
                                Source Image
                                <input type="file" id="hires-image-file" accept="image/*">
                                <span class="help">Upload an image or use "Send to Hires Fix" from txt2img results.</span>
                                <button type="button" id="clear-hires-image">Clear Image</button>
                            </label>
                            <div class="hires-preview">
                                <img id="hires-image-preview" alt="Hires Fix preview" hidden>
                            </div>
                        </div>

                        <div class="form-row two-column">
                            <label>
                                Prompt
                                <textarea id="hires-prompt" name="hires-prompt" rows="4" placeholder="Detailed portrait lighting"></textarea>
                            </label>
                            <label>
                                Negative Prompt
                                <textarea id="hires-negative-prompt" name="hires-negative-prompt" rows="4" placeholder="Artifacts, blurry"></textarea>
                            </label>
                        </div>

                        <div class="form-row three-column">
                            <label>
                                Steps
                                <input type="number" id="hires-steps" name="hires-steps" value="30" min="1" max="150">
                            </label>
                            <label>
                                CFG Scale
                                <input type="number" id="hires-cfg-scale" name="hires-cfg-scale" value="7" min="1" max="20" step="0.5">
                            </label>
                            <label>
                                Denoising Strength
                                <input type="number" id="hires-denoising" name="hires-denoising" value="0.4" min="0" max="1" step="0.01">
                            </label>
                        </div>

                        <div class="form-row three-column">
                            <label>
                                Sampler
                                <select id="hires-sampler" name="hires-sampler">
                                    <option value="">Default</option>
                                </select>
                            </label>
                            <label>
                                Scheduler
                                <select id="hires-scheduler" name="hires-scheduler">
                                    <option value="">Default</option>
                                </select>
                            </label>
                            <label>
                                Upscaler
                                <select id="hires-upscaler" name="hires-upscaler">
                                    <option value="">Latent</option>
                                </select>
                            </label>
                        </div>

                        <div class="form-row three-column">
                            <label>
                                Width
                                <input type="number" id="hires-width" name="hires-width" value="1024" min="64" step="64">
                            </label>
                            <label>
                                Height
                                <input type="number" id="hires-height" name="hires-height" value="1024" min="64" step="64">
                            </label>
                            <label>
                                Batch Size
                                <input type="number" id="hires-batch-size" name="hires-batch-size" value="1" min="1" max="4">
                            </label>
                        </div>

                        <div class="form-row">
                            <button type="submit" id="hires-generate">Generate Hires Fix</button>
                        </div>
                    </form>
                </section>
            </div>
        </section>

        <section class="status" id="status-panel" hidden>
            <div class="progress-container">
                <label>Generation Progress</label>
                <div class="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="progress-info">
                    <span id="progress-text">Waiting...</span>
                    <span id="eta-text"></span>
                </div>
            </div>
            <div class="noise-preview">
                <canvas id="noise-canvas" width="256" height="256"></canvas>
                <img id="progress-image" alt="Current generation preview" hidden>
            </div>
        </section>

        <section class="results">
            <h2>Generated Images</h2>
            <div id="images" class="image-grid">
                <p class="placeholder">No images yet. Generate something amazing!</p>
            </div>
        </section>
    </main>

    <footer>
        <small>Powered by Stable Diffusion Automatic1111 API</small>
    </footer>

    <script src="/app.js" type="module"></script>
</body>
</html>
